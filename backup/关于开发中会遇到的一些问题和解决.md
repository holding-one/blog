# 关于开发中会遇到的一些问题和解决

### 常用的utils

[常用方法](utils.js)



### 1. 格式化时间

Thu May 25 2023 11:59:24 GMT+0800 (中国标准时间)

变 2023-10-20

```js
filterTime(data) {
  //this.dateTime  是需要转换的值
  let date = new Date(data);
  let y = date.getFullYear();
  let m = date.getMonth() + 1;
  m = m < 10 ? "0" + m : m;
  let d = date.getDate();
  d = d < 10 ? "0" + d : d;
  const time = y + "-" + m + "-" + d;
  return time;
},
```



### 2. eslitnt 保存自动格式化(需要安装插件)

```js
// #每次保存的时候将代码按eslint格式进行修复
  "eslint.autoFixOnSave": true,
  "editor.codeActionsOnSave": {
    // 每次保存的时候将代码按eslint格式进行修复
    "source.fixAll.eslint": true
  },
```

 [App.vue](C:\Users\admin\Documents\WeChat Files\wxid_riioewzxwm3y22\FileStorage\File\2023-05\App.vue) 

### 3. 固定列超出隐藏滑动显示布局

```css
    width: 100%;
    margin-top: 1rem;
    overflow-x: scroll;

    display: grid;
    grid-template-columns: 25% 25% 25% 25% 25%;
    grid: 0;  一行四个,多的向右划 然后向下换行
```

### 4.单行溢出隐藏

英文溢出不会...

小程序要用text标签

```vue

    display: -webkit-box; /*弹性伸缩盒子模型显示*/
    -webkit-box-orient: vertical; /*排列方式*/
    -webkit-line-clamp: 1; /*显示文本行数(这里控制多少行隐藏)*/
    overflow: hidden; /*溢出隐藏*/
```



```css
      span {
        width: 158px;
   		white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }
多行
div {
  overflow:hidden;              //超出盒子宽度内容，便溢出隐藏  
  text-overflow:ellipsis;       //用...省略号显示
  display:-webkit-box;          //将对象作为弹性伸缩盒子模型显示
  -webkit-box-orient:vertical;  //从上到下垂直排列子元素
  -webkit-line-clamp:2;         //显示的行数
}
 
如果文本为一段很长的英文或者数字，则需要添加word-wrap: break-word属性
```

#### 5.伪元素背景图片

```css
.edit {
  &::after {
    content: "";
    background: url("@/static/img/edit.png") no-repeat 0% 8%,
      url("@/static/img/delete.png") no-repeat 107% 8%;
    background-size: 35rpx 35rpx;
    width: 100rpx;
    height: 40rpx;
  }
}
```

### 6.动态className

```css
              :class="{
                eventing: item.status == 0,
                eventNotStart: item.status == 1,
                eventFinised: item.status == 2,
              }"
```



### 7. 奇数行偶数行

```css
//奇数行
    &:nth-child(odd) {
      background: #f4f7fa;
    } 
//偶数行
    &:nth-child(even) {
    } 
```

### 8.新添加的属性添加响应式

```js
    async getCommonPerson() {
      try {
        let res = await this.$request.get(
          "/mass/homePage/entryRecord/playerManageList",
          {}
        );
        console.log(res);
        // 最多四个
        this.commonPerson = res.data.splice(0, 4) || [];

        this.commonPerson.forEach((item, index) => {
          this.$set(this.commonPerson[index], "active", false); // vue2更新视图
        });
      } catch (error) {
        console.log(error);
      }
    },

    chooseMessage(index) {
      this.commonPerson.forEach((item) => {
        item.active = false;
      });
      this.$set(this.commonPerson[index], "active", true); // 改百年this.obj.e时 视图会更新


      console.log(this.commonPerson);
    },
```

### 9.生成二维码

[教程](https://blog.csdn.net/weixin_42601136/article/details/114839489)

```shell
npm install vue-qr --save
```

```vue
      <vue-qr :text="inviteUrl" :size="200"></vue-qr>

import vueQr from "vue-qr";

  computed: {
    vueQr
  },
```

```js
  this.inviteUrl =
       "https://devops.yangtuo.cn/qthd/qthd_ydd/index.html#/pages/teamManagement/inviteToTheTeam?teamId=" +
        this.teamId;
```

### 10. 点击复制

```shell
npm i vue-clipboard2
```

```js
main.js

import VueClipboard from 'vue-clipboard2'
Vue.use(VueClipboard)

```

```vue
      <div
        style="color: #4c5fe6; cursor: pointer"
        :data-clipboard-text="detail.telephone"
        @click="copy"
      >
        联系电话：{{ detail.telephone }} 复制
      </div>
```

```vue
    copy() {
      //如果需要回调：
      this.$copyText("需要复制的内容").then(
        (e) => {
          this.$notify({
            title: "",
            message: "复制成功",
            type: "success",
          });
          console.log(e);
        },
        function (e) {
          this.$notify.error({
            title: "",
            message: "复制失败",
            type: "success",
          });
          console.log(e);
        }
      );
    },
```

### 11.vscode的正则

`^\s*(?=\r?$)\n` 替换空白行并删除的方法

### 12. picker

```vue
        <picker
          class="type"
          @change="typeConfirm"
          :value="typeIndex"
          :range="trainTypeList"
          range-key="value"
        >
          <!-- <view class="uni-input">{{ trainTypeList[index] }}</view> -->
          <view
            class="uni-input"

            >{{ trainTypeList[typeIndex].value }}

            <view class="imgIcon"> </view>
          </view>
        </picker>
```

### 13. 手写canvas转图片

```vue

    <u-mask
      :show="posterShow"
      :zoom="false"
      :custom-style="{ background: 'rgba(0,0,0,.8)' }"
      :duration="0"
    >
      <xinyu-canvas-drawer
        ref="poster"
        :width="750"
        :height="1200"
      ></xinyu-canvas-drawer>
      <image
        :src="src"
        style="width: 750rpx; height: 750rpx"
        v-if="src != ''"
      ></image>
      <view class="bottomButton fixedBottom">
        <view class="button" @click="saveImageToPhotosAlbum"> 下载海报 </view>
      </view>
      <div class="close">
        <image
          @click="posterShow = false"
          src="../../../static/closeCycle.png"
          mode="aspectFit"
        />
      </div>
    </u-mask>

<script>

import XinyuCanvasDrawer from "@/uni_modules/xinyu-canvas-drawer/index.vue";
    		  that.rederCanvas()
    async rederCanvas() {
      this.$nextTick(async () => {
        let posterRef = this.$refs.poster;
        uni.showLoading({
          title: "渲染海报中",
        });

        let organizer = this.jobFairDetails.organizer || '';
        let address = this.jobFairDetails.address || '';
		let title = this.jobFairDetails.title || '';

        await posterRef.init();
        let notArr = posterRef
          .setBackgroundColor("#F4F4F4") //指定渲染图片的背景色
          .addImage("../../../static/posterBg.png", 0, 0, 750, 900, false)

          .addImage("../../../static/ava.png", 32, 48, 80, 80, true) //绘制圆图片，如果不绘制圆图片最后一个参数可以不传或传false，当最后一个参数为true时圆形的直径为w，h参数将没有意义

          .addText(title, 180, 60, 30, "#333", 453, false)
          .addText("企业认证", 180, 100, 30, "#666", 453, false)

          .addText('主办方', 50, 200, 30, "#666", 453, false)
          .addText(organizer, 50, 250, 40, "#666", 453, false)

          .addText("地点", 50, 650, 30, "#333", 453, false)
          .addText(address, 50, 690, 30, "#d87161", 453, false)
          .addText("参加企业", 50, 720, 30, "#666", 453, false)

          .addRect(0, 900, 1000, 300, "#FEFEFE") //绘制矩形
          .addText("西湖区就近就业", 19, 1000, 40, "#333", 453, false)
          // .addText("长按图片保存或分享", 19, 1058, 20, "#666", 453, false)
          .addQRCode("http://www.shengxinyustudio.com", 600, 990, 100, 100); //绘制二维码（不要太长否则会扫不出来）

        this.enterpriseList.forEach((item, index) => {
          notArr
            .addRect(50 + index * 110, 760, 100, 30, "#feefec") //绘制矩形

            .addText(
              item.value,
              80 + index * 100,
              765,
              20,
              "#d87161",
              453,
              false
            );
        });

        this.src = await notArr.draw();

        this.isCanvasLoading = true;
        uni.hideLoading();
        this.$forceUpdate();
      });
    },
    </script>

```

### 14.html2canvas 页面转图片

```vue
<script>
    generateImage() {
      const element = document.getElementById("target-element"); // 替换为目标元素的id或class
      html2canvas(element).then(canvas => {
        const image = canvas.toDataURL("image/png");
        const link = document.createElement("a");
        link.href = image;
        link.download = "image.png";
        link.click();
      });
    },
</script>   

```

### 15.Object.assign同名属性的替换

对于这种嵌套的对象，一旦遇到同名属性，**`Object.assign`**的处理方法是替换，而不是添加。

```javascript
const target = { a: { b: 'c', d: 'e' } }
const source = { a: { b: 'hello' } }
Object.assign(target, source)// { a: { b: 'hello' } 
```

### 16. 手写深拷贝

[手写浅拷贝和深拷贝](https://blog.csdn.net/iaz999/article/details/130968237)

```js
export function cloneDeep(obj, map = new WeakMap()) {

    // 获取更详细的数据类型
    function getType(obj) {
        return Object.prototype.toString.call(obj)
    }

    // 处理普通函数和箭头函数
    function cloneFunction(func) {
        const bodyReg = /(?<={)(.|\n)+(?=})/m;
        const paramReg = /(?<=\().+(?=\)\s+{)/;
        const funcString = func.toString();
        if (func.prototype) { //箭头函数是没有prototype的
            console.log('普通函数');
            const param = paramReg.exec(funcString);
            const body = bodyReg.exec(funcString);
            if (body) {
                console.log('匹配到函数体：', body[0]);
                if (param) {
                    const paramArr = param[0].split(',');
                    console.log('匹配到参数：', paramArr);
                    return new Function(...paramArr, body[0]);
                } else {
                    return new Function(body[0]);
                }
            } else {
                return null;
            }
        } else {
            return eval(funcString);
        }
    }

    if (obj === null || obj === undefined) return obj //不进行拷贝
    if (obj instanceof Date) return new Date(obj)
    if (obj instanceof RegExp) return new RegExp(obj)
    // 原始类型
    if (typeof obj !== 'object' && typeof obj !== 'function') return obj
    // 处理普通函数和箭头函数
    if (typeof obj === 'function') return cloneFunction(obj)
    // 是对象就进行深拷贝
    if (map.get(obj)) return map.get(obj)
    let cloneObj = new obj.constructor()
    map.set(obj, cloneObj)

    if (getType(obj) === '[object Map]') {
        obj.forEach((item, key) => {
            cloneObj.set(cloneDeep(key, map), cloneDeep(item, map))
        })
    }
    if (getType(obj) === '[object Set]') {
        obj.forEach(item => {
            cloneObj.add(cloneDeep(item, map))
        })
    }
    for (let key of Object.keys(obj)) {
        cloneObj[key] = cloneDeep(obj[key], map)
    }
    return cloneObj
}


```

### 17. 横向滚动

```html
    <style>
        .tab {
            width: 100px;
            height: 30px;
            line-height: 30px;
            border: 1px solid #000;
            overflow: hidden;

            padding: 20px;
        }

        .tip {
            width: 200px;
            animation: fadenum 4s linear  infinite;
        }

        @keyframes fadenum {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-110px);
            }
        }
    </style>

    <div class="tab">
        <div class="tip">人力资源服务机构/零工中介</div>
    </div>

```

### 18. 表格滚动

```vue
<el-table  ref="tableRef1"></el-table>
<script setup> 
    // 重置滚动高度
    if (tableRef1.value) {
        tableRef1.value.$refs.bodyWrapper.getElementsByClassName("el-scrollbar__wrap")[0].scrollTop = 0
    }
    nextTick(() => {
        scroll(tableRef1.value.$refs.bodyWrapper);
    });
</script>
```

```js
// 表格滚动
export const scroll = (tableBody) => {
    let isScroll = true; //滚动
    const tableDom = tableBody.getElementsByClassName("el-scrollbar__wrap")[0];
    // console.log("tableDom: ", tableDom);

    //鼠标放上去，停止滚动；移开，继续滚动
    tableDom.addEventListener("mouseover", () => {
      isScroll = false;
    });
    tableDom.addEventListener("mouseout", () => {
      isScroll = true;
    });

    setInterval(() => {
        if (isScroll) {
          tableDom.scrollTop += 1; //设置滚动速度
          if (tableDom.clientHeight + tableDom.scrollTop >= tableDom.scrollHeight) {
            tableDom.scrollTop = 0;
          }
        }
      }, 50);
  };
```

### 19. 浙里办打开高德导航软件

```vue
          if (this.OS == 'android') {
						ZWJSBridge.openLink({
							"url": `androidamap://viewMap?sourceApplication=appname&poiname=${address}&lat=${latitude}&lon=${longitude}&dev=0`
						}).then(res => {
							console.log('成功', res)
						}).catch(err => {
							console.log('失败', err)
						})
						setTimeout(() => {
							if (this.jump) {

								ZWJSBridge.openLink({
									"url": `https://uri.amap.com/marker?position=${longitude},${latitude}&name=${address}`
								}).then(res => {
									console.log('成功', res)
								}).catch(err => {
									console.log('失败', err)
								})
              }
						}, 2000)
					}
					if (this.OS == 'ios') {

						// ZWJSBridge.openLink({
						// 	"url": `iosamap://viewMap?sourceApplication=applicationName&poiname=${address}&lat=${longitude}&lon=${latitude}&dev=0`
						// }).then(res => {  
						// 	console.log('成功', res)
						// }).catch(err => {
						// 	console.log('失败', err)
						// })
						// setTimeout(() => {
						// 	if (this.jump) {


            //   }
						// }, 2000)
            //callnative是否尝试调起高德地图APP并在APP中查看，0表示不调起，1表示调起, 默认值为0
            	ZWJSBridge.openLink({
									"url": `https://uri.amap.com/marker?position=${longitude},${latitude}&name=${address}&callnative=1`
								}).then(res => { 
									console.log('成功', res) 
								}).catch(err => {
									console.log('失败', err)
								})

					}
```

### 20. 查看属性在对象的层级

```js
function findPropertyLevel(obj, property, currentLevel = 0) {
  for (let key in obj) {
    if (key === property) {
      return currentLevel;
    }
    if (typeof obj[key] === 'object') {
      const level = findPropertyLevel(obj[key], property, currentLevel + 1);
      if (level !== -1) {
        return level;
      }
    }
  }
  return -1;
}
```

### 21. window.open和location.href

![b5082288b1f729ce2fa7c3e7bd015b1](D:\project_person\assets\b5082288b1f729ce2fa7c3e7bd015b1.png)

### 22. 清除定时器

在uniapp或者vue里面 使用this.timeId 赋值的定时器id 可能清除不掉 可以直接 var timeId  这种定义的来 clear清除

### 23. 数组按照指定顺序排序

```js
sortArray(arr, order) {
    return arr.sort((a, b) => {
        const aIndex = order.indexOf(a.value);
        const bIndex = order.indexOf(b.value);
        return aIndex - bIndex;
    });
}
const order = ['进行中', '待开始', '已结束'];

that.list2 = that.sortArray(that.list2, order) 

```

#### 24. vue全局挂载组件并使用指令控制组件行为

```js
const Toast = {
  install(Vue, options) {
    // 创建一个Toast的Vue实例
    const ToastConstructor = Vue.extend(cellWrapper)
    let instance
    // 在Vue的原型上添加一个全局方法
    Vue.prototype.$toast = (message, duration = 3000) => {
      if (!instance) {
        instance = new ToastConstructor({
          el: document.createElement('div'),
          data() {
            return {
              message: message,
              isShow: true
            }
          }
        })
        // 将实例挂载到body上
        document.body.appendChild(instance.$el)
      } else {
        instance.message = message
        instance.isShow = true
      }
      // 设置延时隐藏
      setTimeout(() => {
        instance.isShow = false
      }, duration)
    }
  }
}

Vue.use(Toast)
```

### 24. nuxt使用hash路由

```
defineNuxtConfig

  router: {
    options:{
      hashMode: true,
    }
  },
```

### 25. 智能JSON解析

```js
    /**
     * 智能JSON解析方法
     * @param {any} data - 需要解析的数据
     * @returns {any} 解析后的数据
     */
    safeJsonParse(data) {
      // 如果不是字符串，直接返回
      if (typeof data !== 'string') {
        return data
      }
      
      // 如果是空字符串，返回null
      if (!data.trim()) {
        return null
      }
      
      try {
        const parsed = JSON.parse(data)
        
        // 如果解析结果是数组，需要递归检查数组中的每个元素
        if (Array.isArray(parsed)) {
          return parsed.map(item => this.safeJsonParse(item))
        }
        
        // 如果解析结果是对象，需要递归检查对象中的每个值
        if (parsed && typeof parsed === 'object') {
          const result = {}
          for (const key in parsed) {
            if (parsed.hasOwnProperty(key)) {
              result[key] = this.safeJsonParse(parsed[key])
            }
          }
          return result
        }
        
        // 其他情况直接返回解析结果
        return parsed
      } catch (error) {
        // 解析失败，返回原始数据
        console.warn('JSON解析失败，返回原始数据:', data)
        return data
      }
    },
```

